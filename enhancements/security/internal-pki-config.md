---
title: internal-pki-config
authors:
  - "@jubittajohn"
  - "@sanchezl"
  - "@dinhxuanvu"
  - "@ksiddiqu"
reviewers:
  - "@patrickdillon" # cluster infrastructure team, installer integration and Day-1 certificate generation
  - "@sadasu" # cluster infrastructure team, installer integration and Day-1 certificate generation
  - "@sjenning" # kube-apiserver team, API server certificate rotation and configuration
  - "@hasbro17" # etcd team, etcd certificate configuration and rotation
  - "@dusk125"  # etcd team, etcd certificate configuration and rotation
  - "@p0lyn0mial" # authentication team, service-ca and client certificate management
#  - TBD # security team, PKI architecture and certificate lifecycle management
approvers:
  - "@sjenning" # staff engineer with PKI and security expertise
api-approvers:
  - "@everettraven" # new API in config.openshift.io/v1alpha1
creation-date: 2025-10-20
last-updated: 2026-02-25
tracking-link:
  - https://issues.redhat.com/browse/OCPSTRAT-2271
  - https://issues.redhat.com/browse/CNTRLPLANE-1735
see-also:
  - "/enhancements/authentication/service-ca-cert-generation-for-statefulset-pods.md"
  - "/enhancements/authentication/automated-service-ca-rotation.md"
---

# Configurable PKI for OpenShift Internal Certificates

## Summary

This enhancement introduces the ability to configure cryptographic parameters (key algorithm, key size, and elliptic curves) for certificates and keys generated internally by OpenShift components. Currently, OpenShift uses hardcoded defaults (primarily RSA 2048-bit keys) for all internally generated certificates, with no mechanism for administrators to adjust these parameters to meet organizational security requirements or compliance mandates.

This proposal adds a new resource in the `config.openshift.io` API group:

- **PKI**: A cluster-level configuration resource that allows administrators to specify cryptographic parameters at multiple levels: global defaults and category overrides (explicit fields for signer, serving, and client certificates).

OpenShift uses a flat PKI topology where signer certificates directly sign serving and client certificates, rather than a traditional hierarchical CA model.

## Motivation

Enterprise customers are increasingly required to meet stringent security compliance requirements that mandate specific cryptographic parameters for PKI infrastructure. Common requirements include:

- Larger RSA key sizes (3072-bit or 4096-bit) for long-lived certificates
- Use of elliptic curve cryptography (ECDSA) for better performance with equivalent security
- Consistent cryptographic parameters across the entire certificate hierarchy
- Ability to align with organizational PKI policies

Currently, OpenShift provides no mechanism to configure these parameters for internally generated certificates, forcing customers to either accept the hardcoded defaults or seek exemptions from their security policies. This creates significant friction for adoption in regulated industries and government environments.

### User Stories

* As a security administrator in a regulated industry, I want to configure OpenShift to use 4096-bit RSA keys for all signer certificates, so that I can comply with my organization's PKI policy and security standards.

* As a platform engineer, I want to configure OpenShift to use ECDSA P-384 for serving certificates, so that I can improve cryptographic operations performance while meeting CNSA 2.0 requirements for top-secret workloads.

* As a cluster administrator, I want to configure different key sizes for different certificate types (larger keys for long-lived CAs, smaller keys for frequently rotated certificates), so that I can balance security requirements with performance considerations.

* As a compliance officer, I want to verify that all internally generated certificates in my OpenShift cluster use cryptographic parameters that meet my organization's requirements, so that I can audit compliance with security policies.

* As an OpenShift SRE, I want to monitor the cryptographic parameters of certificates being generated in the cluster through metrics and alerts, so that I can detect and remediate any certificates that don't meet the configured policy.

### Goals

- Provide a declarative API for configuring cryptographic parameters (algorithm, key size, curve) for OpenShift internal certificates
- Support configuration at different levels of granularity: global defaults and certificate category overrides (signer, serving, client), with extensibility for future per-certificate override types
- Support RSA (with configurable key sizes: 2048-8192 in multiples of 1024) and ECDSA (with configurable curves: P-256, P-384, P-521) algorithms in the initial implementation
- Apply configuration to both Day-1 certificates (generated by openshift-installer) and Day-2 certificates (rotated by cluster operators)
- Maintain backward compatibility: clusters upgraded without PKI configuration continue using existing defaults
- Ensure new certificates generated during rotation respect the PKI configuration
- Provide metrics and observability for certificate generation events and configuration compliance

### Non-Goals

- Modifying certificate lifetimes or rotation schedules (this is handled by existing mechanisms)
- Supporting external CA integration or certificate injection (this is covered by existing user-provided certificate features such as cert-manager and custom CA bundles)
- Automatic rotation of existing certificates to new cryptographic parameters (rotation happens on natural certificate expiry or forced rotation events)
- Supporting algorithms beyond RSA and ECDSA in the initial implementation (e.g., Ed25519, RSA-PSS)
- Configuring signature algorithms separately from key algorithms (signature algorithm is derived from key type)
- Changing certificate subject names, SANs, or other X.509 extensions (only cryptographic parameters)
- Retrospectively changing certificates that have already been generated (only applies to new generation/rotation)

### Relationship to Existing Certificate Configuration Features

OpenShift provides several certificate-related configuration mechanisms. This enhancement affects OpenShift’s internal certificate generation, not user-provided certificates, trust anchors, TLS parameters, or external CA integration.

#### User-Provided Certificates (Out of Scope)

**APIServer.spec.servingCerts**:
- Allows administrators to provide **custom serving certificates** for the API server
- Certificates are **externally generated** and **injected** into OpenShift
- This PKI enhancement does **not** affect user-provided certificates
- Relationship: **Complementary** - administrators choose between:
  - Using this PKI API to configure how OpenShift **generates** its internal certificates, OR
  - Using APIServer.servingCerts to **provide** externally-generated certificates

**Custom CA Bundles** (e.g., APIServer.spec.clientCA, Proxy.spec.trustedCA):
- Allows injection of custom CA certificates for trust purposes
- Does not configure certificate generation
- This PKI enhancement does **not** affect custom CA bundles
- Relationship: **Independent** - custom CA bundles control trust, this API controls generation

**cert-manager and External CA Integration**:
- Tools like cert-manager can request certificates from external CAs
- Typically used for workload certificates, not platform infrastructure
- This PKI enhancement does **not** affect cert-manager workflows
- Relationship: **Independent** - different use cases (platform infrastructure vs. workload certificates)

#### TLS Security Profiles (Related but Distinct)

**TLSSecurityProfile**:
- Configures **cipher suites** and **TLS protocol versions**
- Applied to API server, ingress, and other TLS endpoints
- Does **not** configure certificate generation parameters
- This PKI enhancement does **not** modify TLS security profiles
- Relationship: **Complementary** - both work together:
  - TLSSecurityProfile: Controls **how TLS connections are negotiated** (protocol version, ciphers)
  - PKI API: Controls **how certificates are generated** (key algorithm, key size)
  - Example: Administrator can configure ECDSA P-384 certificates (PKI API) with TLS 1.3 and strong cipher suites (TLSSecurityProfile)

#### Summary Table

| Feature | Scope | What It Configures | Relationship to PKI API |
|---------|-------|-------------------|------------------------|
| **PKI API** (this enhancement) | Internal certificates | Key algorithm, key size, curve | N/A (this proposal) |
| **APIServer.servingCerts** | API server serving certs | User-provided certificates | Complementary (choose one or the other) |
| **Custom CA Bundles** | Trust anchors | Trusted CA certificates | Independent (different concern) |
| **cert-manager** | Workload certificates | External CA integration | Independent (different use case) |
| **TLSSecurityProfile** | TLS connections | Cipher suites, TLS versions | Complementary (both apply together) |

## Proposal

This proposal introduces a new resource in the `config.openshift.io/v1alpha1` API group, along with a `ConfigurablePKI` feature gate to control the rollout:

- **PKI**: A cluster-scoped singleton configuration resource that allows administrators to specify cryptographic parameters for internal certificates organized by defaults and category overrides (explicit fields for signer, serving, and client certificates).

**Note:** During development, the API will start as `v1alpha1` with TechPreviewNoUpgrade feature gate enablement. The API will be promoted to `v1` and the feature gate will be enabled by default before the target OpenShift release, shipping as GA.

**Note:** Named certificate overrides (targeting individual certificates by name) are planned for a future release. The validation design for certificate names requires a cluster-wide resource for name registration, which needs further work.

At a high level, the changes include:

1. **New API Resource**:
   - `PKI` configuration resource in `config.openshift.io/v1alpha1` (cluster-scoped singleton)
2. **Feature Gate**: `ConfigurablePKI` to enable the functionality (TechPreviewNoUpgrade during development, enabled by default at GA)
3. **Installer Integration**: Limited Day-1 configuration support for signer certificate cryptographic parameters
4. **Operator Updates**: Modifications to certificate-generating operators to:
   - Watch and consume the PKI configuration independently
5. **Certificate Rotation**: Operators apply PKI configuration parameters during existing certificate rotation cycles (no changes to rotation mechanisms themselves)
6. **Metrics and Observability**: Expose metrics for certificate generation events and configuration compliance

Note: There is **no central PKI controller**. Each certificate-generating operator watches the PKI resource directly and applies configuration to its own certificates.

### Workflow Description

**cluster administrator** is a human user responsible for configuring and managing the OpenShift cluster.

#### Initial Cluster Installation (Day-1)

1. The cluster administrator prepares an install-config.yaml that includes PKI configuration for signer certificates:

```yaml
apiVersion: v1
baseDomain: example.com
metadata:
  name: my-cluster
platform:
  aws:
    region: us-east-1
# New PKI configuration section
pki:
  signerCertificates:
    key:
      algorithm: RSA
      rsa:
        keySize: 4096
```

2. The openshift-installer generates the cluster, creating signer certificates using the specified cryptographic parameters (4096-bit RSA keys).

3. All other certificates (serving certificates, client certificates) are generated using default parameters at installation time, as they will be rotated within 24 hours of cluster creation.

4. The installer creates the initial `PKI` custom resource in the cluster reflecting the Day-1 configuration.

#### Post-Installation Configuration (Day-2)

1. The cluster administrator wants to configure ECDSA P-384 for all serving certificates to improve performance:

```bash
oc edit pki cluster
```

2. The administrator modifies the PKI resource:

```yaml
apiVersion: config.openshift.io/v1alpha1
kind: PKI
metadata:
  name: cluster
spec:
  certificateManagement:
    # Use Custom mode to explicitly configure cryptographic parameters
    mode: Custom

    custom:
      # Global default for all certificates (key is required in defaults)
      defaults:
        key:
          algorithm: RSA
          rsa:
            keySize: 2048

      # Category-level overrides (optional, explicit fields)
      signerCertificates:
        key:
          algorithm: RSA
          rsa:
            keySize: 4096

      servingCertificates:
        key:
          algorithm: ECDSA
          ecdsa:
            curve: P384

      clientCertificates:
        key:
          algorithm: ECDSA
          ecdsa:
            curve: P256
```

3. On the next rotation cycle (either natural expiry or forced rotation), operators generate new certificates using the configured parameters.

4. The cluster administrator can monitor the transition through metrics:

```promql
# Verify certificates are being generated with correct parameters
openshift_pki_certificate_generated_total{algorithm="ECDSA",curve="P384",category="Serving"}
```

#### Forced Certificate Rotation with New Parameters

Use pre-existing workflow to force certificate rotation using the current PKI configuration.


#### Upgrade Scenario

1. A cluster running OpenShift 4.N is upgraded to 4.N+1 which includes this feature.

2. The upgrade installs the PKI CRD (API definition) and creates a PKI resource with `spec.certificateManagement.mode: Unmanaged`.

3. With `spec.certificateManagement.mode: Unmanaged`, all operators continue using their existing hardcoded defaults, ensuring zero behavior change.

4. The cluster administrator can update the PKI resource post-upgrade to `spec.certificateManagement.mode: Default` or `spec.certificateManagement.mode: Custom` with configuration, which will apply on the next certificate rotation cycle.

5. Existing certificates continue to function until their natural rotation.

### API Extensions

This enhancement adds a new Custom Resource Definition (CRD) to the OpenShift API:

- **PKI**: Cluster-scoped singleton for configuring certificate cryptographic parameters

#### Compatibility Level

The PKI API will be developed initially at **Compatibility Level 4** (TechPreviewNoUpgrade) and graduate to **Compatibility Level 1** (GA) before the target OpenShift release.

- **Development phase (v1alpha1, Level 4):**
  - No compatibility guarantees during development
  - API can change at any point for any reason
  - Breaking changes are allowed without migration path
  - Suitable for iterative development and testing
  - Gated by ConfigurablePKI feature gate with TechPreviewNoUpgrade enablement

- **Release phase (v1, Level 1):**
  - Shipped as GA in target OpenShift release
  - Breaking changes no longer allowed
  - API stable within major release for 12 months or 3 minor releases
  - Full backward compatibility guarantees

- **Graduation timeline:**
  - v1alpha1 at Level 4: Early development (feature gate: TechPreviewNoUpgrade)
  - v1 at Level 1: Target OpenShift release (feature gate: enabled by default)
  - No intermediate v1beta1 or TechPreview release planned

The compatibility level is enforced through the `+openshift:compatibility-gen:level` annotation and will be validated by the API review process. The annotation will change from `level=4` to `level=1` when the API is promoted to v1.

#### PKI Resource

The `PKI` resource is a cluster-scoped singleton named `cluster` in the `config.openshift.io/v1alpha1` API group.

```go
// PKI configures cryptographic parameters for certificates generated
// internally by OpenShift components.
type PKI struct {
    metav1.TypeMeta   `json:",inline"`
    metav1.ObjectMeta `json:"metadata,omitempty"`
    Spec              PKISpec `json:"spec,omitzero"`
}

type PKISpec struct {
    CertificateManagement PKICertificateManagement `json:"certificateManagement,omitzero"`
}

// PKICertificateManagement is a union; mode is the discriminator.
// custom is required when mode is Custom, and forbidden otherwise.
type PKICertificateManagement struct {
    // mode: "Unmanaged", "Default", or "Custom".
    Mode   PKICertificateManagementMode `json:"mode,omitempty"`
    Custom CustomPKIPolicy              `json:"custom,omitzero"`
}

type PKICertificateManagementMode string // Unmanaged | Default | Custom

type CustomPKIPolicy struct {
    PKIProfile `json:",inline"`
}

// PKIProfile defines certificate generation parameters.
// Category overrides take precedence over defaults.
type PKIProfile struct {
    // defaults applies to all certificates unless overridden. Key is required.
    Defaults             DefaultCertificateConfig  `json:"defaults,omitzero"`
    // signerCertificates overrides parameters for CA certificates.
    SignerCertificates   CertificateConfig         `json:"signerCertificates,omitempty,omitzero"`
    // servingCertificates overrides parameters for TLS serving certificates.
    ServingCertificates  CertificateConfig         `json:"servingCertificates,omitempty,omitzero"`
    // clientCertificates overrides parameters for client auth certificates.
    ClientCertificates   CertificateConfig         `json:"clientCertificates,omitempty,omitzero"`
}

// DefaultCertificateConfig requires all fields so every certificate has
// a well-defined key configuration.
type DefaultCertificateConfig struct {
    Key KeyConfig `json:"key,omitzero"` // required
}

// CertificateConfig is used in overrides. At least one field must be set.
type CertificateConfig struct {
    Key KeyConfig `json:"key,omitempty,omitzero"` // optional in overrides
}

// KeyConfig is a union; algorithm is the discriminator.
// Exactly one of rsa or ecdsa must be set.
type KeyConfig struct {
    Algorithm KeyAlgorithm   `json:"algorithm,omitempty"` // RSA | ECDSA
    RSA       RSAKeyConfig   `json:"rsa,omitzero"`        // required when RSA
    ECDSA     ECDSAKeyConfig `json:"ecdsa,omitzero"`      // required when ECDSA
}

type RSAKeyConfig struct {
    KeySize int32 `json:"keySize,omitempty"` // 2048–8192, multiples of 1024
}

type ECDSAKeyConfig struct {
    Curve ECDSACurve `json:"curve,omitempty"` // P256 | P384 | P521
}

type KeyAlgorithm string // RSA | ECDSA
type ECDSACurve   string // P256 | P384 | P521
```

### Topology Considerations

#### Hypershift / Hosted Control Planes

For Hypershift deployments, the PKI configuration applies to certificates generated in both the management cluster and guest clusters:

- **Management Cluster**: The PKI resource in the management cluster controls certificates for hosted control plane components (API server, controller manager, etcd running in the management cluster).

- **Guest Cluster**: Each hosted cluster can have its own PKI configuration resource that controls certificates for guest cluster components (kubelet, in-cluster operators).

- **Separation**: Hypershift's architecture naturally separates control plane and data plane certificates, making it straightforward to apply different policies to each.

#### Standalone Clusters

This enhancement is fully applicable and relevant for standalone clusters. All internally generated certificates will respect the PKI configuration.

#### Single-node Deployments or MicroShift

**Single-Node OpenShift (SNO):**
- Fully supported with the same API and behavior as multi-node clusters
- Resource consumption impact is minimal - operators watch the PKI resource (same as other config resources)
- Certificate generation is infrequent (only during rotation), so the choice of RSA vs ECDSA has minimal runtime impact

**MicroShift:**
- The PKI configuration should be exposed through MicroShift's YAML configuration file
- Example MicroShift configuration:

```yaml
apiVersion: v1alpha1
kind: MicroShiftConfig
pki:
  certificateManagement:
    mode: Custom
    custom:
      defaults:
        key:
          algorithm: ECDSA
          ecdsa:
            curve: P256
      signerCertificates:
        key:
          algorithm: RSA
          rsa:
            keySize: 4096
```

- MicroShift's lighter weight makes ECDSA particularly attractive for resource-constrained environments
- The MicroShift team should map this configuration to the same internal PKI infrastructure

### Implementation Details/Notes/Constraints

#### Certificate Category Classification

OpenShift's internal PKI uses a **flat topology** rather than a traditional hierarchical CA model. Certificates are classified into three categories based on their purpose and lifecycle:

1. **Signer Certificates** (`Signer`): CA certificates that directly sign either serving or client certificates
   - Examples: `etcd-signer`, `kube-apiserver-to-kubelet-signer`, `service-ca`, `kubelet-bootstrap-kubeconfig-signer`, `admin-kubeconfig-signer`
   - Typical lifetime: **Varies by purpose**
     - **10 years**: Signers for bootstrapping new nodes and disaster recovery (e.g., `kubelet-bootstrap-kubeconfig-signer`, `admin-kubeconfig-signer`, `kube-apiserver-localhost-signer`, `kube-apiserver-service-network-signer`, `kube-apiserver-lb-signer`)
     - **1 year**: Control plane signers that are rotated by operators (e.g., `kube-apiserver-to-kubelet-signer`, `kube-control-plane-signer`)
     - **1 day**: Short-lived signers for frequently rotated certificates (e.g., `aggregator-signer`, `kubelet-signer`)
   - Generated: Mix of Day-1 (installer) and Day-2 (operators)
   - Purpose: Each signer is responsible for a specific trust domain (e.g., etcd peer communication, kubelet authentication)
   - Distribution: Signers are distributed to various CA bundles throughout the cluster based on expected trust relationships between components
   - Note: These are not "root CAs" in the traditional sense as they don't form a hierarchical chain; each signer directly signs leaf certificates

2. **Serving Certificates** (`Serving`): TLS serving certificates for cluster components
   - Examples: kube-apiserver serving cert, etcd serving certs, service serving certs
   - Typical lifetime: 30-365 days
   - Generated: Mostly Day-2, rotated frequently
   - Signed by: A signer certificate in the `Signer` category
   - Purpose: Present a server identity during TLS handshakes

3. **Client Certificates** (`Client`): Client authentication certificates
   - Examples: kubelet client certs, controller client certs, service account client certs
   - Typical lifetime: 1-30 days
   - Generated: Mostly Day-2, rotated very frequently
   - Signed by: A signer certificate in the `Signer` category
   - Purpose: Authenticate clients to servers

#### Certificate Rotation and Cross-Signing

OpenShift manages certificate rotation through a combination of operator-driven processes and the cluster's internal PKI infrastructure:

- **Signer rotation**: When a signer certificate is rotated (rare event), the system may temporarily create a cross-signing certificate to maintain trust during the transition. The new signer signs a certificate for the old signer's public key, allowing old leaf certificates to remain valid while new ones are issued.

- **CA bundle management**: The cluster automatically manages CA bundles (collections of trusted signer certificates) and updates them when signers are rotated. Components watch these bundles and reload them to maintain trust relationships.

- **Leaf certificate rotation**: Serving and client certificates are rotated according to their configured lifetimes. During rotation, new certificates are signed by the current signer, and the system coordinates updates to ensure zero downtime.

#### Configuration Resolution Order

When generating a certificate, the cryptographic parameters are determined by the following precedence (highest to lowest):

1. **Category Override**: If the corresponding category field (`signerCertificates`, `servingCertificates`, or `clientCertificates`) is set, use those parameters
2. **Default Configuration**: Use the `defaults` configuration
3. **Platform Defaults**: Use hardcoded platform defaults (typically RSA 2048)

#### Day-1 (Installer) Integration

The openshift-installer will support a limited subset of PKI configuration:

```yaml
# install-config.yaml
apiVersion: v1
metadata:
  name: my-cluster
# ... other configuration ...
pki:
  signerCertificates:
    key:
      algorithm: RSA
      rsa:
        keySize: 4096
```

Rationale for limiting Day-1 configuration:
- **10-year signer certificates**: The installer generates several long-lived (10-year) signer certificates specifically for **bootstrapping new nodes** (e.g., `kubelet-bootstrap-kubeconfig-signer`) and **disaster recovery** (e.g., `admin-kubeconfig-signer`). These certificates are never automatically rotated by cluster operators, making Day-1 configuration critical.
- **Shorter-lived certificates**: The installer also generates 1-year and 1-day signers, as well as serving and client certificates. These are rotated by cluster operators (most within 24 hours of installation), so they can be configured via the PKI resource post-installation.
- **Simplicity**: Keeping installer configuration simple reduces complexity and potential for misconfiguration during cluster bootstrap.
- **Source of truth**: The installer-generated PKI resource serves as the source of truth for ongoing operations.

The installer will:
1. Generate all signer certificates (10-year, 1-year, and 1-day) using the specified parameters (or defaults if not configured)
2. Generate serving and client certificates using platform defaults
3. Create the initial PKI resource with the `signerCertificates` field matching the install-config
4. Document that administrators should configure `servingCertificates` and `clientCertificates` fields post-installation

#### Operator Integration

Each operator that generates certificates will:

1. Watch the `PKI` cluster resource for changes
2. Implement configuration resolution logic to determine parameters for each certificate
3. Apply new parameters during the next certificate rotation (natural expiry or forced)
4. Report metrics on certificate generation events
5. Update operator status conditions if configuration is invalid or cannot be applied

Key operators to update:
- `cluster-kube-apiserver-operator` - API server serving and client certificates
- `cluster-etcd-operator` - etcd peer and client certificates
- `cluster-kube-controller-manager-operator` - Controller manager client certificates
- `service-ca-operator` - Service CA and service serving certificates (see special note below)
- `machine-config-operator` - Kubelet certificates
- `cluster-authentication-operator` - OAuth server certificates

**Special Case: service-ca-operator**

The [service-ca-operator](https://github.com/openshift/service-ca-operator) generates serving certificates on-demand for services annotated with `service.beta.openshift.io/serving-cert-secret-name`. This operator behaves differently from other certificate-generating operators:

- **Signer certificate (`service-ca`)**: Can be configured via the `signerCertificates` field to specify cryptographic parameters for the service CA itself
- **Service serving certificates**: Generated on-demand and will use:
  - **Defaults** configuration if specified in the PKI resource
  - **`servingCertificates`** field if specified in the PKI resource
  - Platform defaults (RSA 2048) if no PKI configuration exists

**Important limitation**: Individual service serving certificates cannot be configured independently because:
- They are generated dynamically in response to service annotations
- There are potentially thousands of services in a cluster
- Certificate names are service-specific (e.g., `<namespace>/<service-name>`) and not well-known at the platform level

This design is intentional and maintains consistency with the PKI API's philosophy: defaults apply broadly and category overrides target certificate categories.

#### Validation

The PKI API uses **CRD-level CEL validation** for comprehensive validation.

**CRD-Level CEL Validation (PKI resource):**

1. **Union enforcement** (`PKICertificateManagement` type):
   - When `mode == "Custom"`: `custom` field must be set
   - When `mode != "Custom"`: `custom` field must not be set
   - CEL rule: `self.mode == 'Custom' ? has(self.custom) : !has(self.custom)`

2. **Union enforcement** (`KeyConfig` type):
   - When `algorithm == "RSA"`: `rsa` field must be set, `ecdsa` field must not be set
   - When `algorithm == "ECDSA"`: `ecdsa` field must be set, `rsa` field must not be set

3. **CertificateConfig minimum properties:**
   - `+kubebuilder:validation:MinProperties=1` ensures at least one field is set in override certificate configs

4. **DefaultCertificateConfig required fields:**
   - `key` is required in defaults to ensure all certificates have a well-defined key configuration

5. **Enum and range constraints:**
   - `mode`: Unmanaged, Default, Custom
   - `algorithm`: RSA, ECDSA
   - `keySize`: Multiples of 1024 from 2048 to 8192
   - `curve`: P256, P384, P521

**Additional Runtime Validation:**
- Operators validate that certificate lifetimes are compatible with key sizes (e.g., log warning if using RSA 2048 for a 10-year certificate)
- Metrics flag certificates that don't meet configured parameters (indicating a bug or misconfiguration)

#### API Extensibility

The API is designed for future extensibility through the `CertificateConfig` type:

**Current fields:**
- `key` - Cryptographic parameters for key generation

**Future additions** (examples, not committed for v1alpha1):
- `lifetime` - Certificate validity period override
- `rotation` - Rotation policy configuration
- `extensions` - Custom X.509 extensions
- `signatureAlgorithm` - Signature algorithm override (if different from key algorithm)

New certificate-level configuration can be added to `CertificateConfig` without restructuring the API hierarchy. This maintains backward compatibility while allowing the API to evolve with new requirements.

**Design note:** The `key` field is optional in `CertificateConfig` (used by category overrides), even though it is currently the only field. This is intentional: when future fields are added (e.g., `lifetime`), an administrator should be able to override just that new field without also specifying `key`. The `+kubebuilder:validation:MinProperties=1` constraint ensures that at least one field is always set, preventing empty overrides today while allowing any single future field to be set independently. In `DefaultCertificateConfig`, `key` is required because defaults must fully specify all certificate parameters.

#### Performance Considerations

The choice of algorithm and key size has performance implications:

**RSA Key Generation:**
- RSA 2048: ~100ms per key pair on modern CPU
- RSA 3072: ~500ms per key pair
- RSA 4096: ~2-3 seconds per key pair

**ECDSA Key Generation:**
- P-256: ~10ms per key pair
- P-384: ~15ms per key pair
- P-521: ~20ms per key pair

**TLS Handshake Performance:**
- RSA: Slower handshakes, scales with key size
- ECDSA: Faster handshakes, less CPU intensive

**Recommendations:**
- Use larger RSA keys (3072/4096) for long-lived signer certificates where generation is rare
- Use ECDSA for frequently rotated certificates (serving certs, client certs) to reduce rotation overhead
- Use ECDSA P-384 for compliance with CNSA 2.0 while maintaining good performance

These tradeoffs will be documented in user-facing documentation to help administrators make informed choices.

#### Metrics and Observability

Each certificate-generating component (operators and installer) will expose Prometheus metrics about certificate generation events and properties.

**Metric Exposure Patterns:**

1. **Long-running components** (operators): Expose metrics directly via existing Prometheus endpoints
2. **Short-lived components** (installer): Write metrics to node-exporter textfile collector at `/var/lib/node_exporter/textfile_collector/openshift_pki_installer.prom`

**Metrics:**

1. **Certificate Information (Gauge):**
   ```promql
   openshift_pki_certificate_info{
     certificate_name="kube-apiserver-to-kubelet-signer",
     category="Signer",
     algorithm="RSA",
     key_size="4096",           # only present for RSA
     curve="",                  # only present for ECDSA
     component="kube-apiserver-operator",
     namespace="openshift-kube-apiserver-operator"
   } 1
   ```
   - **Purpose:** Info metric providing certificate inventory with all cryptographic properties
   - **Cardinality:** ~50-100 certificates cluster-wide
   - **Use case:** Query which certificates exist and their parameters

2. **Certificate Generation Events (Counter):**
   ```promql
   openshift_pki_certificate_generated_total{
     certificate_name="kube-apiserver-to-kubelet-signer",
     category="Signer",
     algorithm="RSA",
     key_size="4096",
     curve="",
     component="kube-apiserver-operator",
     result="success"  # or "failure"
   } 42
   ```
   - **Purpose:** Track certificate generation and rotation events
   - **Use case:** Monitor rate of certificate generation, detect rotation patterns

3. **Certificate Generation Duration (Histogram):**
   ```promql
   openshift_pki_certificate_generation_duration_seconds{
     certificate_name="kube-apiserver-to-kubelet-signer",
     algorithm="RSA",
     key_size="4096",
     curve="",
     component="kube-apiserver-operator"
   }
   ```
   - **Purpose:** Track performance of certificate generation operations
   - **Buckets:** [0.01, 0.1, 0.5, 1, 2, 5, 10] seconds
   - **Use case:** Identify performance issues with RSA 4096 vs ECDSA, detect slow generation

**Example Queries:**

- Find all RSA certificates not using 4096-bit keys:
  ```promql
  openshift_pki_certificate_info{algorithm="RSA",key_size!="4096"}
  ```

- RSA 4096 generation performance (95th percentile):
  ```promql
  histogram_quantile(0.95,
    rate(openshift_pki_certificate_generation_duration_seconds_bucket{algorithm="RSA",key_size="4096"}[5m])
  )
  ```

- Certificate inventory by algorithm:
  ```promql
  count by (algorithm) (openshift_pki_certificate_info)
  ```

**Cardinality Estimate:**

Assuming ~50 well-known certificates cluster-wide:
- `openshift_pki_certificate_info`: ~50 time series
- `openshift_pki_certificate_generated_total`: ~100 time series (success/failure)
- `openshift_pki_certificate_generation_duration_seconds`: ~50 histograms × 10 buckets = 500 time series

**Total estimated cardinality: ~650 time series** - manageable overhead for cluster-wide certificate monitoring.

### Risks and Mitigations

**Risk: Invalid PKI configuration in install-config.yaml prevents cluster installation**

*Mitigation:*
- Installer validates PKI configuration schema before starting cluster creation
- Clear error messages indicate which PKI parameters are invalid
- Installation fails fast with actionable error message before any resources are created
- Documentation provides validated examples for common configurations
- Install-config validation can be tested with `openshift-install create manifests` without committing to full installation

**Risk: Invalid configuration causes certificate generation failures (Day-2)**

*Mitigation:*
- Comprehensive CEL validation rules prevent most invalid configurations at admission time
- Invalid configurations are rejected before being persisted (fail-fast)
- Operators report detailed errors in status conditions and events
- Fallback to platform defaults if configuration cannot be applied
- Support procedures document how to identify and fix configuration issues

**Risk: Incompatible cryptographic parameters across certificate hierarchy**

Example: Signing a certificate with a stronger key than the CA itself

*Mitigation:*
- Documentation includes best practices for certificate hierarchies
- CEL validation ensures configuration is structurally valid (algorithm/keySize/curve consistency)
- Metrics expose the cryptographic parameters of all certificates for audit
- Operators log warnings for potentially problematic configurations (e.g., weak keys for long-lived certs)

**Risk: Performance degradation from large RSA keys**

*Mitigation:*
- Documentation clearly explains performance implications of different key sizes
- Recommend ECDSA for frequently rotated certificates
- Metrics track certificate generation duration to identify bottlenecks

**Risk: Upgrade disruption if PKI configuration is misconfigured**

*Mitigation:*
- Empty/absent PKI configuration preserves existing behavior
- Changes only apply at next rotation, not immediately
- Forced rotation requires explicit annotation, not automatic

**Risk: Security downgrade if configuration allows weak parameters**

*Mitigation:*
- Minimum supported parameters (RSA 2048, ECDSA P-256) meet current best practices
- Future versions can increase minimums without breaking compatibility
- Metrics and alerts can detect use of minimum parameters if policy requires stronger

### Drawbacks

**Increased Complexity**: This feature adds a new configuration surface that administrators must understand. However, it is entirely optional - clusters continue to work with defaults if not configured.

**Maintenance Burden**: Each certificate-generating operator must be updated to support PKI configuration. However, the implementation is straightforward (read config, apply parameters), and the centralized configuration reduces operator-specific configuration sprawl.

**Limited Day-1 Configuration**: Only signer certificate parameters are configurable at install time. However, this is appropriate given that all other certificates rotate within 24 hours.

**No Automatic Re-keying**: Changing PKI configuration doesn't automatically regenerate all certificates. However, automatic re-keying of all certificates could be disruptive and is better handled through normal rotation or explicit forced rotation.

## Alternatives (Not Implemented)

### Alternative 1: Operator-Specific Configuration

Each operator could expose its own API for certificate configuration (e.g., `KubeAPIServerOperatorConfig.spec.certificateKeySize`).

**Not selected because:**
- Requires administrators to configure each operator individually
- No consistency across the cluster
- Difficult to audit and enforce policy
- More complex to implement (many API changes vs. one central API)

### Alternative 2: Per-Certificate Configuration

The PKI API could require explicit configuration of every certificate by name, without defaults or categories.

**Not selected because:**
- Extremely verbose for large clusters (hundreds of certificates)
- Higher chance of misconfiguration (missing a certificate)
- Difficult to apply consistent policy across certificate types
- Poor user experience

### Alternative 3: Support All Cryptographic Algorithms

Support a wider range of algorithms from the start (Ed25519, RSA-PSS, etc.).

**Not selected because:**
- RSA and ECDSA cover the vast majority of use cases
- Additional algorithms increase implementation and testing burden
- Can be added in future releases based on demand
- Golang crypto library has varying support for different algorithms

### Alternative 4: Automatic Certificate Re-keying

Automatically regenerate all certificates when PKI configuration changes.

**Not selected because:**
- Could cause significant disruption (certificate rotation across entire cluster)
- Difficult to orchestrate safely (race conditions, ordering)
- Normal rotation will apply changes naturally over time
- Forced rotation annotation provides escape hatch if immediate re-keying needed

### Alternative 5: Additional Certificate Metrics

Include metrics for certificate expiry, not-before timestamps, generation errors, and configuration compliance.

**Considered metrics:**
- `openshift_pki_certificate_expiry_timestamp_seconds` - Certificate expiration timestamp
- `openshift_pki_certificate_not_before_timestamp_seconds` - Certificate validity start timestamp
- `openshift_pki_certificate_generation_errors_total` - Counter for certificate generation failures
- `openshift_pki_certificate_config_compliant` - Whether certificate matches current PKI configuration

**Not selected because:**

1. **Certificate expiry and not-before metrics:**
   - Certificate expiry monitoring will be handled in a separate enhancement
   - Existing certificate monitoring solutions already track expiry
   - Keeping scope focused on PKI configuration feature

2. **Certificate generation errors metric:**
   - Certificate generation code is straightforward with minimal error paths
   - Errors are primarily programmatic or I/O-related (out of disk, permission errors)
   - Automatic retries handle transient failures
   - The `openshift_pki_certificate_generated_total` metric already tracks success/failure via the `result` label
   - Detailed error categorization adds complexity without significant operational value

3. **Configuration compliance metric:**
   - No central component to implement compliance checking
   - Each operator would need to duplicate config resolution logic (for generation AND compliance)
   - Ambiguity about "expected" values when PKI config changes after certificate generation
   - Certificate might be old but was compliant when generated
   - Adds significant implementation complexity to every operator
   - Users can query compliance via PromQL using `openshift_pki_certificate_info` metric:
     ```promql
     # Find RSA certificates not using 4096-bit keys
     openshift_pki_certificate_info{algorithm="RSA",key_size!="4096"}
     ```
   - Compliance checking could be addressed in a future enhancement with a dedicated compliance-checker component if needed

## Open Questions

None at this time.

## Test Plan

**Unit Tests:**
- PKI API validation (CEL validation rules)
- Category override fields validation (signerCertificates, servingCertificates, clientCertificates)
- CertificateConfig MinProperties validation
- DefaultCertificateConfig key required validation
- Configuration resolution logic (precedence rules)
- Certificate generation with different algorithms and parameters
- RSA key size combinations: 2048, 3072, 4096, and 8192 bits
- ECDSA curve combinations: P-256, P-384, and P-521
- Upgrade path (empty config → defaults)

**Integration Tests:**
- Deploy cluster with PKI configuration in install-config
- Verify signer certificates generated with correct parameters
- Create PKI resource post-installation
- Verify certificate rotation applies new parameters
- Test configuration changes (edit PKI resource)
- Verify metrics reflect correct certificate parameters

**E2E Tests:**
- Install cluster with RSA 4096 signer certificates
- Configure ECDSA P-384 for serving certificates post-install
- Force certificate rotation
- Verify all serving certificates use ECDSA P-384 after rotation
- Upgrade cluster from version without feature to version with feature
- Verify existing certificates continue to work and rotate with defaults
- Create PKI config post-upgrade and verify it applies on next rotation

**Performance Tests:**
- Measure certificate generation time for different algorithms/sizes
- Measure TLS handshake latency with large RSA key sizes (4096 and 8192 bits) to quantify performance impact compared to RSA 2048 and ECDSA alternatives
- Validate that ECDSA provides expected performance improvements for TLS handshakes

**Compatibility Tests:**
- Verify old clients can connect to servers with ECDSA certificates
- Verify RSA and ECDSA certificates can coexist in the same cluster
- Test certificate chains with mixed algorithms (ECDSA cert signed by RSA CA)

## Graduation Criteria

This feature will be released as **GA in OpenShift 4.N**. The graduation criteria must be met before the 4.N release.

### Dev Preview -> Tech Preview

During early development with v1alpha1 and TechPreviewNoUpgrade feature gate:

- Feature complete as described in this enhancement
- ConfigurablePKI feature gate available with TechPreviewNoUpgrade enablement
- PKI CRD installed
- Installer integration for signer certificate configuration
- At least kube-apiserver-operator, etcd-operator, and service-ca-operator:
  - Support PKI configuration for certificate generation
- Comprehensive unit and integration test coverage
- Metrics for certificate generation events
- Basic documentation in openshift-docs
- Early feedback gathered from development testing

### Tech Preview -> GA

Before the 4.N release, all of the following criteria must be met:

- All certificate-generating operators:
  - Support PKI configuration for certificate generation
- Thorough e2e test coverage including upgrade scenarios
- **API promoted to v1 at Compatibility Level 1:**
  - PKI API stable
  - Breaking changes no longer allowed
  - API stable within major release for 12 months or 3 minor releases
  - Comprehensive migration path from v1alpha1 if breaking changes were made
  - All API fields finalized and documented
- Performance testing validates ECDSA performance improvements
- Performance testing validates acceptable TLS handshake and certificate generation latency across all supported RSA key sizes (2048 through 8192 bits), with documented results characterizing the impact of large key sizes
- **E2E test requirements met:**
  - Minimum 5 tests tagged with `[OCPFeatureGate:ConfigurablePKI]`
  - Tests run on all supported platforms (AWS, Azure, GCP, bare metal, etc.)
  - At least 14 test runs per platform
  - 95% pass rate achieved across all platforms (Level 1 requirement)
  - Tests cover: installation with PKI config, Day-2 configuration, rotation, upgrade scenarios
- Comprehensive user-facing documentation including:
  - Configuration examples for common scenarios
  - Best practices for certificate hierarchies
  - Performance implications of different algorithms
  - Troubleshooting guide
  - **API migration guide (v1alpha1 → v1)** if breaking changes were made
- SLIs defined and documented:
  - Certificate generation success rate
  - Certificate generation duration
  - Configuration application success rate
- Support procedures documented for common failure modes
- Feature gate enabled by default
- Hypershift integration tested and documented
- MicroShift integration complete
- Internal testing and feedback incorporated from development cycle

### Removing a deprecated feature

This enhancement does not deprecate or remove any existing features. It adds new functionality for configuring cryptographic parameters while maintaining all existing defaults and behaviors.

## Upgrade / Downgrade Strategy

**Upgrade:**

When upgrading from a version without this feature to a version with it:

1. The PKI CRD is installed during upgrade
2. A PKI resource is automatically created with `spec.certificateManagement.mode: Unmanaged`
3. With `spec.certificateManagement.mode: Unmanaged`, operators use their existing hardcoded defaults, ensuring zero behavior change
5. Existing certificates continue to function unchanged
6. Certificate rotation uses existing defaults until the PKI resource is updated
7. Administrators can update the PKI resource post-upgrade to `spec.certificateManagement.mode: Default` or `spec.certificateManagement.mode: Custom` with configuration
8. New parameters apply on the next rotation cycle after PKI resource is updated

This approach ensures zero disruption during upgrade and preserves backward compatibility.

**Downgrade:**

When downgrading from a version with this feature to a version without it:

1. The PKI CRD remains in the cluster but is ignored
2. Operators revert to hardcoded defaults for new certificate generation
3. Existing certificates continue to function (they don't change on downgrade)
4. Certificate rotation uses hardcoded defaults
5. The PKI resource can be deleted manually if desired, or left in place for future upgrade

No manual intervention is required for downgrade. Certificates generated with non-default parameters continue to work (certificate verification doesn't change).

**Version Skew:**

During rolling upgrades, different operator versions will coexist:
- A PKI resource with `spec.certificateManagement.mode: Unmanaged` is automatically created during upgrade
- Old operator versions don't know about PKI configuration and use hardcoded defaults
- New operator versions check for PKI resource, find `mode: Unmanaged`, and use hardcoded defaults
- All operators use the same default parameters (typically RSA 2048), ensuring consistency
- Administrator can update the PKI resource after upgrade completes to configure parameters
- Certificate rotation is gradual and asynchronous
- Mixed algorithms (RSA and ECDSA) are explicitly supported when intentionally configured

## Version Skew Strategy

Version skew is not a concern for this feature because:

- All supported OpenShift component versions can validate and use both RSA (2048-8192) and ECDSA (P-256/P-384/P-521) certificates
- Certificate verification is based on CA trust, not on specific algorithms or key sizes
- Components communicate using standard TLS, which transparently handles different certificate types
- Each operator independently manages its own certificates without coordination

During upgrades:
- The empty PKI resource created during upgrade ensures all operators (old and new) use consistent defaults
- Administrators can update PKI configuration after upgrade completes
- Certificate rotation is gradual and asynchronous per existing mechanisms
- Mixed certificate parameters across the cluster are explicitly supported

## Operational Aspects of API Extensions

### PKI CRD

**SLIs:**
- PKI resource exists and is readable: `GET /apis/config.openshift.io/v1alpha1/pkis/cluster` returns 200
- CEL validation functions correctly: PKI resource creation/updates succeed with valid configuration and are rejected with invalid configuration
- Operators can watch and read PKI resource: Operators successfully retrieve PKI configuration

**Impact on Existing SLIs:**

This feature has minimal impact on existing SLIs because:
- Certificate generation is infrequent (only during rotation)
- Each operator independently watches the PKI resource (no central controller overhead)
- Configuration validation happens at admission time (doesn't impact runtime)
- Operators already watch multiple config resources, adding one more has negligible impact

However, there are some considerations:

1. **Certificate Rotation Duration**: Larger RSA keys increase rotation time
   - RSA 4096 adds ~2 seconds per certificate vs RSA 2048
   - For a cluster with ~50 certificates rotating hourly, this adds ~100 seconds total
   - Impact: Negligible on user-facing workloads (rotation is background process)

2. **API Admission Latency**: CEL validation adds minimal latency (<1ms)
   - Only impacts PKI resource create/update operations (rare)
   - CEL validation runs in-process at API server (faster than webhook calls)
   - Does not impact other resource types

3. **Operator Resource Consumption**: Watching the PKI resource adds minimal overhead
   - Memory: Negligible (one additional watch, cached resource is small <10KB)
   - CPU: Negligible (config changes are rare, operators already watch many resources)

**Failure Modes:**

1. **Invalid Configuration**:
   - *Symptom*: PKI resource creation/update is rejected by CEL validation
   - *Impact*: Configuration change is blocked, existing certificates continue to rotate with current config
   - *Mitigation*: CEL validation errors clearly identify the problem with specific field and rule
   - *Detection*: Client (oc, console) receives error message with CEL validation failure details

2. **Operator Cannot Read PKI Resource**:
   - *Symptom*: Operator logs show errors watching or reading PKI resource
   - *Impact*: Operator falls back to hardcoded defaults for certificate generation
   - *Mitigation*: Operator continues functioning with defaults, RBAC/API server issues should be investigated
   - *Detection*: Operator logs show watch/get errors, operator status may show Degraded condition

3. **Unsupported Configuration**:
   - *Symptom*: PKI configuration specifies parameters that an older operator doesn't support
   - *Impact*: Operator falls back to defaults and reports Degraded condition
   - *Mitigation*: Status condition explains what's unsupported, suggests upgrade
   - *Detection*: Operator status condition, events, logs

**Teams for Escalation:**
- **Security Team**: Configuration policy questions, cryptographic parameter selection
- **API Review Team**: API design, CRD issues
- **TRT/Platform Team**: Operational issues, certificate rotation failures
- **Component Teams**: Issues with specific certificate-generating operators

## Support Procedures

### Detection and Diagnosis

**Symptom: PKI configuration is not being applied to new certificates**

1. Check PKI resource exists and is valid:
   ```bash
   oc get pki cluster -o yaml
   ```

2. Verify ConfigurablePKI feature gate is enabled:
   ```bash
   oc get featuregate cluster -o yaml | grep ConfigurablePKI
   ```

3. Check certificate-generating operator status:
   ```bash
   oc get clusteroperator kube-apiserver -o yaml
   # Look for Degraded=True conditions related to PKI
   ```

4. Review operator logs for PKI-related errors:
   ```bash
   oc logs -n openshift-kube-apiserver-operator deployment/kube-apiserver-operator | grep -i pki
   ```

5. Check metrics for certificate generation events:
   ```promql
   openshift_pki_certificate_generated_total{algorithm="ECDSA"}
   ```

**Symptom: Certificate generation failures**

1. Check operator events:
   ```bash
   oc get events -n openshift-kube-apiserver-operator --field-selector reason=CertificateGenerationFailed
   ```

2. Check operator logs for certificate generation errors:
   ```bash
   oc logs -n openshift-kube-apiserver-operator deployment/kube-apiserver-operator | grep -i "certificate.*error"
   ```

3. Verify cryptographic libraries are functioning:
   ```bash
   # Operator logs should show successful key generation test on startup
   oc logs -n openshift-kube-apiserver-operator deployment/kube-apiserver-operator | grep "crypto test"
   ```

**Symptom: Certificates have wrong parameters after rotation**

1. Extract certificate from secret:
   ```bash
   oc get secret -n openshift-kube-apiserver kube-apiserver-serving-cert -o jsonpath='{.data.tls\.crt}' | base64 -d | openssl x509 -text -noout
   ```

2. Check public key algorithm and size:
   ```bash
   # Look for "Public Key Algorithm" and "Public-Key" fields
   ```

3. Compare against PKI configuration:
   ```bash
   oc get pki cluster -o jsonpath='{.spec.certificateManagement.custom.servingCertificates.key}'
   ```

4. Check certificate generation time vs PKI configuration update time:
   ```bash
   # Certificate NotBefore time should be after PKI config update
   oc get pki cluster -o jsonpath='{.metadata.creationTimestamp}'
   ```

### Reverting to Default State

1. Set the PKI resource to Default mode to revert to platform defaults:
   ```bash
   oc patch pki cluster --type merge -p '{"spec":{"certificateManagement":{"mode":"Default"}}}'
   ```

2. Operators will use hardcoded platform defaults (typically RSA 2048) for new certificate generation

3. **Certificates transition gradually:**
   - Existing certificates continue to function unchanged
   - New certificates generated during rotation use platform defaults
   - Natural rotation applies defaults over time (varies by certificate lifetime)
   - Force rotation by deleting certificate secrets if immediate change is needed

### Recovery Procedures

**Scenario: Invalid PKI configuration was applied and certificates are failing**

1. If PKI resource update was recent (< 1 hour), use kubectl rollback:
   ```bash
   # This may not work if validation prevented the change
   oc rollout undo pki cluster
   ```

2. Otherwise, manually edit PKI resource to valid configuration:
   ```bash
   oc edit pki cluster
   # Remove or fix invalid configuration
   ```

3. Wait for natural certificate rotation, or force rotation by deleting certificate secrets:
   ```bash
   # Each operator regenerates certificates when secrets are deleted
   # Example for kube-apiserver serving certificate:
   oc delete secret -n openshift-kube-apiserver kube-apiserver-serving-cert
   ```

4. Monitor rotation progress:
   ```bash
   oc get clusteroperators
   # Wait for all operators to report Available=True, Progressing=False
   ```

**Scenario: Certificates with wrong parameters are causing compatibility issues**

1. Identify problematic certificates:
   ```bash
   # Check API server logs for TLS handshake failures
   oc logs -n openshift-kube-apiserver kube-apiserver-xxx | grep -i tls
   ```

2. Determine if issue is with serving cert or client cert:
   - Serving cert issues: clients can't connect to server
   - Client cert issues: server rejects client authentication

3. Update PKI configuration to use compatible parameters:
   ```bash
   oc edit pki cluster
   # Change to more compatible algorithm (e.g., ECDSA P-521 → RSA 2048)
   ```

4. Force rotation of affected certificate by deleting the secret:
   ```bash
   # Delete the secret to force regeneration
   oc delete secret -n openshift-kube-apiserver kube-apiserver-serving-cert
   ```

5. Verify new certificate is generated and working:
   ```bash
   oc get secret -n openshift-kube-apiserver kube-apiserver-serving-cert -o jsonpath='{.metadata.creationTimestamp}'
   # Should show recent timestamp after regeneration
   ```

**Scenario: Need to revert all certificates to defaults**

1. Delete the PKI resource:
   ```bash
   oc delete pki cluster
   ```

2. Wait for natural certificate rotation, or force rotation by deleting certificate secrets:
   ```bash
   # Delete certificate secrets to force regeneration
   # Example for kube-apiserver serving certificate:
   oc delete secret -n openshift-kube-apiserver kube-apiserver-serving-cert
   # Repeat for other certificates as needed
   ```

3. Certificates will be regenerated with platform defaults

## Infrastructure Needed [optional]

No special infrastructure is needed for this enhancement. All development and testing can use existing OpenShift CI infrastructure.

For documentation:
- User-facing docs in openshift-docs repository
- Admin guide section for PKI configuration
- Security hardening guide updates
- Certificate management section updates

## Future Extensions

The following features are not included in the initial release but may be added in future versions:

### Named Certificate Overrides

Named certificate overrides (targeting individual certificates by name) are deferred to a future release. The original design envisioned multiple `PKICertificateDefinition` parameter resources (one per operator) to register certificate names for validation. However, ValidatingAdmissionPolicy evaluates parameter resources one at a time, making cross-resource validation infeasible. A cluster-wide single resource that aggregates all registered certificate names is needed so validation can check all names at once. This redesign requires further work.

The infrastructure needed includes:

- **PKICertificateDefinition resource**: A cluster-wide resource that aggregates the certificates managed by all operators, enabling validation of certificate names in PKI overrides without hardcoding them in the CRD.

- **Validation approach**: Certificate name validation (ensuring names in overrides reference registered certificates) requires further design. The approach needs to handle the bootstrapping challenge of operators registering certificates while the PKI resource may already reference them.

**Well-known certificate names** that would be used in `namedCertificates` and registered via `PKICertificateDefinition` resources for runtime validation:

#### Signer Certificates (Category: Signer)

These CA certificates directly sign serving or client certificates. OpenShift uses a flat PKI topology rather than a hierarchical CA model.

| Certificate Name | Description | Managed By |
|------------------|-------------|------------|
| `kube-apiserver-localhost-signer` | Signs kube-apiserver localhost serving certificates | kube-apiserver-operator |
| `kube-apiserver-service-network-signer` | Signs kube-apiserver service network serving certificates | kube-apiserver-operator |
| `kube-apiserver-lb-signer` | Signs kube-apiserver load balancer serving certificates | kube-apiserver-operator |
| `kube-apiserver-to-kubelet-signer` | Signs kube-apiserver to kubelet client certificates | kube-apiserver-operator |
| `aggregator-signer` | Signs aggregator client certificates for API server extension | kube-apiserver-operator |
| `etcd-signer` | Signs etcd peer and client certificates | etcd-operator |
| `etcd-metrics-signer` | Signs etcd metrics serving certificates | etcd-operator |
| `service-ca` | Signs service serving certificates | service-ca-operator |

#### Serving Certificates (Category: Serving)

Serving certificates present server identity during TLS handshakes.

| Certificate Name | Description | Managed By |
|------------------|-------------|------------|
| `kube-apiserver-localhost-server` | Localhost SNI endpoint | kube-apiserver-operator |
| `kube-apiserver-service-network-server` | Service network SNI endpoint | kube-apiserver-operator |
| `kube-apiserver-lb-server` | External load balancer SNI endpoint | kube-apiserver-operator |
| `kube-apiserver-internal-lb-server` | Internal load balancer SNI endpoint | kube-apiserver-operator |
| `etcd-peer-server` | etcd peer communication | etcd-operator |
| `etcd-server` | etcd client connections | etcd-operator |
| `etcd-metrics-server` | etcd metrics endpoint | etcd-operator |

#### Client Certificates (Category: Client)

Client certificates authenticate clients to servers.

| Certificate Name | Description | Managed By |
|------------------|-------------|------------|
| `kube-apiserver-to-kubelet-client` | API server authentication to kubelet | kube-apiserver-operator |
| `aggregator-client` | API server aggregation proxy | kube-apiserver-operator |

**Note:** These names will be available for use in `namedCertificates` once named certificate overrides are implemented. Operators will register these names dynamically via `PKICertificateDefinition` resources. Additional certificates may be registered by other operators as they adopt the PKI configuration API.

### Additional Certificate Configuration Options

The `CertificateConfig` type is designed for extensibility. Future releases may add:

- **Lifetime configuration**: Override default certificate validity periods
- **Rotation policy**: Configure rotation schedules and overlap periods
- **X.509 extensions**: Custom extensions for specific compliance requirements
- **Signature algorithm override**: Separate signature algorithm from key algorithm

### Additional Cryptographic Algorithms

The initial release supports RSA and ECDSA. Future releases may add:

- **Ed25519**: Modern elliptic curve with excellent performance
- **RSA-PSS**: Probabilistic signature scheme for RSA
- **Post-quantum algorithms**: As standards mature

### Certificate Expiry Monitoring

A separate enhancement may add comprehensive certificate monitoring:

- Certificate expiry metrics and alerts
- Compliance dashboards
- Automated rotation recommendations